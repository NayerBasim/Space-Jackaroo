package model.card;

import java.util.List;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Scanner;



import model.card.standard.*;
import model.card.wild.*;
import engine.GameManager;
import engine.board.BoardManager;

public class Deck {
	private final static String CARDS_FILE = "Cards.csv";
	private static ArrayList<Card> cardsPool ; 
											
	public Deck(){ // changed you will find it down (loadCardPool)
		//cardsPool = new ArrayList<Card>(); 
		
	}
	public static String[] split_correctly(String s){
		String[] out = new String[6];
		String temp = "";
		int element = 0;
		for(int i = 0 ; i < s.length(); i++){
				if(s.charAt(i) != ',' ){
					temp += s.charAt(i);
				}	
				else{
					out[element++] = temp;
					temp = "";
				}
			}
			out[5] = temp;
			
				
			return out;	
		}
		
		
	
	public static void handleString(String s, BoardManager boardManager, GameManager gameManager){
		String[] arr = split_correctly(s);
		if((arr[0].equals("14") || arr[0].equals("15")) && arr.length == 6){
			arr[3] = arr[3] + "," + arr[4] + "," + arr[5];
			arr[4] = "";
			arr[5] = "";
		}
		//System.out.println(arr[0] + "// " +arr[1] + "// "+ arr[2] + "// "+ arr[3] + " //" +arr[4] + "// "+ arr[5] );
		int code  = Integer.parseInt(arr[0]);
		int frequency = Integer.parseInt(arr[1]);
		String name = arr[2];
		String description = arr[3];
		if(arr[4].length() > 0 && arr[5].length() > 0){


			int rank = Integer.parseInt(arr[4]);

			
			Suit suit =  Suit.valueOf(arr[5]);
			
			switch(code){
			case 0:
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Standard(name, description, rank, suit, boardManager, gameManager));
				}
				break;
			case 1 :
				for(int i = 0 ; i < frequency; i++){
					Card ace = new Ace(name, description, suit, boardManager, gameManager);
					if(cardsPool != null)
						cardsPool.add(0, ace);
				}
				break;
			case 4 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Four(name, description, suit, boardManager, gameManager));
				}
				break;
			case 5 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Five(name, description, suit, boardManager, gameManager));
				}
				break;
			case 7 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Seven(name, description, suit, boardManager, gameManager));
				}
				break;
			case 10 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Ten(name, description, suit, boardManager, gameManager));
				}
				break;
			case 11 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Jack(name, description, suit, boardManager, gameManager));
				}
				break;
			case 12 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Queen(name, description, suit, boardManager, gameManager));
				}
				break;
			case 13 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new King(name, description, suit, boardManager, gameManager));
				}
				break;
			default:
				System.out.println("Not a valid id number in cards" + code);
				
			}
		}else if(arr[4].length() == 0 && arr[5].length() == 0){

			switch(code){
			
			case 14 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Burner(name, description, boardManager, gameManager));
				}
				break;
			case 15 :
				for(int i = 0 ; i < frequency; i++){
					if(cardsPool != null)
					cardsPool.add(0,new Saver(name, description, boardManager, gameManager));
				}
				break;
			default:
				System.out.println("Not a valid id number in wild " + code);
				
			}
				
		}
			
	}

	public static void loadCardPool(BoardManager boardManager, GameManager gameManager) throws IOException{

		try {
			  cardsPool = new ArrayList<Card>(); // new changes
		      File myObj = new File(CARDS_FILE);
		      Scanner myReader = new Scanner(myObj);
		      while (myReader.hasNextLine()) {
		        String data = myReader.nextLine();
		        handleString(data, boardManager , gameManager);
		      }
		      myReader.close();
		    } catch (FileNotFoundException e) {
		      System.out.println("An error occurred on opening the csv file");
		      e.printStackTrace();
		    }
	}
	public static ArrayList<Card> drawCards(){
		if(cardsPool != null){
			Collections.shuffle(cardsPool);
			ArrayList<Card> out = new ArrayList<Card>();
			for(int i = 0 ; i < 4 ; i++){
				out.add(cardsPool.remove(0));
			}
			return out;
			
		}
		return new ArrayList<Card>();
		
	}
	
	
}
