package scene;

import java.io.IOException;
import java.util.ArrayList;

import components.Board;
import components.CPUPlayer1;
import components.CPUPlayer2;
import components.CPUPlayer3;
import components.MainPlayer;
import components.PlayerHand;
import controller.GameController;
import javafx.geometry.Insets;
import javafx.scene.Cursor;
import javafx.scene.Node;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.ToggleButton;
import javafx.scene.effect.DropShadow;
import javafx.scene.image.Image;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundImage;
import javafx.scene.layout.BackgroundPosition;
import javafx.scene.layout.BackgroundRepeat;
import javafx.scene.layout.BackgroundSize;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.StackPane;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import model.card.Card;
import view.Main;

public class GameScreen {
	  private Scene GameScene;
	  private static final int GRID_SIZE = 51;      // must be odd
	  private static final int TOTAL_TRACKS = 100;  // weâ€™ll skip the center to get 100
	  private static final int CELL_SIZE = 12;      // px
	  private static final double CIRCLE_RADIUS = 4;
	  private final String PlayerName;
	  private final Main app;
	public GameScreen(Main app, String PlayerName, GameController controller) throws IOException{
			BorderPane root = new BorderPane();
			this.PlayerName = PlayerName;
			this.app=app;
			
			Board brd = new Board(controller);
	  	    StackPane grid =brd.boardRoot;
	  	    grid.setMaxSize(100, 100);
	  	    

	  	    
	        ArrayList<Card> playerHand=controller.getHands().get(0);
	        
	        PlayerHand playerHandPane=new PlayerHand();
	        
	        for(Card card: playerHand) {
	        	ToggleButton currToggle= playerHandPane.addCard(card);
	        	
	        	currToggle.setOnMouseClicked(event -> {
	        		
	        		
	        		currToggle.setPrefSize(80, 110);
	        		
	        		for( Node n : playerHandPane.getChildren()){
	        			n.setStyle("");
	        		}
	        		currToggle.setStyle(
	        			    "-fx-border-color: black;" +
	        			    "-fx-border-width: 5;" +
	        			    "-fx-border-radius: 5;" +
	        			    "-fx-background-radius: 5;" +// Optional: matches rounded corners
	        			    "-fx-padding: 5;"
	        			);
	        		
	        		
	                Boolean alert = controller.selectCard(card);
	                if(!alert) {app.showAlert("Invalid Card Exception", "Chosen card is not in your hand");}
	            });
	    		
	    		currToggle.setOnMouseEntered(e -> {currToggle.setScaleX(1.1);
	    		currToggle.setTranslateX(10);
	    		currToggle.setTranslateY(-10);
	    		currToggle.setCursor(Cursor.HAND);
	    		DropShadow shadow = new DropShadow();
	    		currToggle.setEffect(shadow);
	    		});
	    		
	    		
	    		
	    		currToggle.setOnMouseExited(e -> {currToggle.setScaleX(1.0);
	    		currToggle.setTranslateX(0);
	    		currToggle.setTranslateY(0);
	    		currToggle.setCursor(Cursor.DEFAULT);
	    		currToggle.setEffect(null);
	    		});

	    		
	            
	    	
	        }
	        
	        
	        
	        

	        
	        
	        root.setBottom(new CPUPlayer2(app,controller.getHands().get(2)).getPlayer());
	        root.setRight(new CPUPlayer1(app,controller.getHands().get(1)).getPlayer());
	        root.setTop(new MainPlayer(app, PlayerName , playerHandPane).getPlayer());
	        root.setLeft(new CPUPlayer3(app,controller.getHands().get(3)).getPlayer());
	        root.setCenter(grid);
	        root.setPadding(new Insets(0,0,100,0));
	        
	        Image backgroundImage = new Image("gameBackground.png");
	        BackgroundImage bgImage = new BackgroundImage(
	            backgroundImage,
	            BackgroundRepeat.NO_REPEAT,
	            BackgroundRepeat.NO_REPEAT,
	            BackgroundPosition.DEFAULT,
	            new BackgroundSize(
	                100, 100, true, true, true, true
	            )
	        );
	        root.setBackground(new Background(bgImage));
	        
	        
	        Button play = new Button("Play");
	        root.getChildren().addAll(play);  //testing
	        play.setOnAction(e -> {
	        	controller.playGUI(grid.getsafeZones(), baseZones, trackCircles);
	        });
	        Scene scene = new Scene(root,900,500);
		     this.GameScene = scene;
		    




	}

	private StackPane createCircle(int number) {
        Circle circle = new Circle(15);
        circle.setFill(Color.LIGHTBLUE);
        circle.setStroke(Color.DARKBLUE);

        StackPane pane = new StackPane();
        pane.getChildren().add(circle);
        pane.setPrefSize(CELL_SIZE, CELL_SIZE);

        return pane;
    }

	
	public Scene getScene(){
		return this.GameScene;
	}
}